# EchoMap 前端功能全景梳理

本文档基于用户全流程视角，梳理前端已实现、部分实现及待开发的功能模块。

**状态图例：**
- ✅ **[已实现]**: UI 与逻辑均已完成。
- ⚠️ **[UI原型/Mock]**: 界面已开发，但数据是假的，或逻辑未接通后端。
- 📝 **[待开发]**: 目前缺失该功能。

---

## 1. 地图探索与交互 (Map Interface)
*核心主界面，承载声音锚点的展示。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **地图渲染** | 加载底图瓦片。 | 已使用 `react-leaflet` 实现真实地图组件 `LeafletMap`。 |
| ✅ | **声音锚点 (Marker)** | 在地图上显示声音位置。 | 已实现基于经纬度的真实锚点渲染。 |
| ✅ | **用户定位** | 获取当前用户 GPS 位置。 | `page.tsx` 中已调用 `navigator.geolocation` 获取坐标。 |
| 📝 | **地图聚合 (Clustering)** | 密集区域点聚合。 | 尚未引入 `react-leaflet-cluster` 等库。 |
| ✅ | **视口联动** | 拖动地图时触发后端搜索。 | `LeafletMap` 支持视口变化监听，可触发区域查询。 |

## 2. 声音采集 (Capture & Upload)
*用户录制并上传声音的流程。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **录音交互** | 录音按钮动画、状态切换。 | `RecordButton.tsx` 使用 Framer Motion 实现了精美的交互。 |
| ✅ | **音频采集** | 调用麦克风录制音频流。 | 使用 `MediaRecorder` API 实现，支持生成 Blob 数据。 |
| ✅ | **声波可视化** | 录音时显示音量波纹。 | 使用 `AudioContext` 分析音频频谱并驱动 UI 动画。 |
| ✅ | **上传逻辑** | 将音频发送至后端。 | `handleUpload` 已调用 `api.uploadRecord` 对接真实后端接口。 |

## 3. 播放与详情 (Playback & Detail)
*点击锚点后的消费体验。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **详情卡片 UI** | 展示故事、标签、情感颜色。 | `AudioDetailOverlay.tsx` UI 已完成。 |
| ✅ | **音频播放** | 播放声音文件。 | 已绑定真实 URL，支持播放/暂停及进度控制。 |
| ✅ | **数据来源** | 获取声音详情数据。 | 已对接 `api.getMapRecords` 获取真实后端数据。 |

## 4. 用户与个人中心 (User & Profile)
*用户身份管理界面。*

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **自动注册/登录** | 用户认证入口。 | `page.tsx` 中实现了基于 LocalStorage 的自动 Guest 用户注册/登录。 |
| 📝 | **个人主页** | 查看“我的发布”列表。 | 暂无独立页面，但后端已提供相关接口。 |

## 5. 基础设施 (Infrastructure)

| 状态 | 功能点 | 描述 | 当前现状/备注 |
| :--- | :--- | :--- | :--- |
| ✅ | **路由与框架** | Next.js 14 (App Router)。 | 项目结构搭建完成。 |
| ✅ | **样式系统** | Tailwind CSS。 | 全局样式已配置。 |
| ✅ | **API 客户端** | 统一的 HTTP 请求封装。 | `services/api.ts` 已封装 `fetch` 请求工具。 |
| 📝 | **状态管理** | 全局状态 (User, Map)。 | 目前主要使用 React `useState`，复杂交互可能需要 Context 或 Zustand。 |

---

### 总结：下一步前端开发重点
1.  **地图聚合**: 引入 `react-leaflet-cluster` 优化大量点位的显示性能。
2.  **个人中心**: 开发用户个人主页，展示“我的发布”和“我的收藏”。
3.  **体验优化**: 增加加载骨架屏、错误处理提示等细节体验。